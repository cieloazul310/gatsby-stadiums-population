{"version":3,"sources":["webpack:///./src/components/BuffersArcs.tsx","webpack:///./src/templates/maps.tsx","webpack:///./.cache/gatsby-browser-entry.js","webpack:///./.cache/public-page-renderer.js","webpack:///./.cache/public-page-renderer-prod.js","webpack:///./src/image/place.svg","webpack:///./src/utils/withRoot.tsx","webpack:///./src/utils/tileTree.ts","webpack:///./src/components/MeshFeature.tsx","webpack:///./src/components/GrayScaleFilter.tsx","webpack:///./src/components/MapApp.tsx"],"names":["color","scaleSequential","interpolateSpectral","domain","withStyles","themes","root","props","classes","buffers","width","height","size","Math","min","dirs","map","feature","properties","radius","population","directions","createDirection","str","direction","items","index","arr","Object","assign","directionToAngle","from","to","val","buffersToDirection","d3arc","outerRadius","innerRadius","padAngle","core_browser_esm","className","transform","dir","key","item","i","arc","d","fill","pow","PI","x","dy","textAnchor","y","_feature$properties","north","northeast","east","southeast","south","southwest","west","northwest","angle","length","startAngle","indexOf","endAngle","withRoot","theme","createStyles","apptitle","flexGrow","autoSizerWrapper","description","maxWidth","margin","padding","data","edges","allVenuesJson","_data$venuesJson","venuesJson","summary","topojson","geojson","topofeature","objects","points","features","name","radius1000","radius3000","radius5000","radius10000","AppBar_default","a","position","Toolbar_default","Typography_default","variant","IconButton_default","aria-owns","aria-haspopup","onClick","slugs","edge","node","slug","next","round","random","navigate","ArrowForward_default","es","_ref","MapApp","BuffersArcs","gatsby_browser_entry","query","StaticQueryContext","React","createContext","StaticQuery","_emotion_core__WEBPACK_IMPORTED_MODULE_0__","Consumer","staticQueryData","render","children","graphql","Error","propTypes","PropTypes","object","string","isRequired","func","m","module","exports","require","default","ProdPageRenderer","location","pageResources","loader","getResourcesForPathnameSync","pathname","createElement","InternalPageRenderer","json","shape","createMuiTheme","palette","primary","lightblue","secondary","blueGrey","typography","useNextVariants","Component","_material_ui_core_styles__WEBPACK_IMPORTED_MODULE_2__","_material_ui_core_CssBaseline__WEBPACK_IMPORTED_MODULE_5___default","TileSet","options","this","tileUrl","url","tileTree","treeIncludesTile","tile","z","hasOwnProperty","toString","tile2tree","_x$toString","_this$tileTree$z$toSt","_this$tileTree$z$toSt2","fetchTiles","tiles","_this","Promise","resolve","tasks","fetchTile","all","then","_this2","fetchUrl","replace","fetch","res","ok","blob","tileWithURL","URL","createObjectURL","catch","undefined","isRequireFetch","_this3","every","setTileUrlFromTree","_this4","filter","updateTiles","_callee","newTiles","tilesInTree","tilesShouldFetch","fetchedTiles","_this5","regenerator_default","wrap","_context","prev","sent","abrupt","concat","stop","colorScale","sizeScale","scalePow","range","exponent","MeshRect","projection","center","geometry","coordinates","abs","max","scale","fillOpacity","style","mixBlendMode","filterMatrix","GrayScaleFilter","id","type","values","join","d3tile","Map","state","fetchStatus","_tileSet","_getTileCoordinates","_this$props","translate","v","array","mag","_fetchTiles","componentDidMount","_this$props2","geoMercator","fitExtent","path","geoPath","tileCoords","renderTiles","setState","components_GrayScaleFilter","opacity","xlinkHref","stroke","strokeWidth","MeshFeature","Place","transition","buffer","main"],"mappings":"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","file":"component---src-templates-maps-tsx-c9f99a7cec7590374aef.js","sourcesContent":["import * as React from 'react';\nimport { Theme } from '@material-ui/core/styles/createMuiTheme';\nimport withStyles, { WithStyles, StyleRules } from '@material-ui/core/styles/withStyles';\nimport { arc as d3arc } from 'd3-shape';\nimport { scaleSequential } from 'd3-scale';\nimport { interpolateSpectral } from 'd3-scale-chromatic';\n\nimport { Buffer } from '../utils/types';\n\nconst styles = (themes: Theme): StyleRules => ({\n  root: {}\n});\n\ninterface Props extends WithStyles<typeof styles> {\n  width?: number;\n  height?: number;\n  buffers: Buffer[];\n}\n\nconst color = scaleSequential(interpolateSpectral).domain([10000, 0]);\n\nconst BufferArcs: React.FunctionComponent<Props> = (props: Props) => {\n  const { classes, buffers, width, height } = props;\n  const size = width && height ? Math.min(width, height) : 320;\n  const data = buffers.map(feature =>\n    feature.properties\n      ? {\n          radius: feature.properties.radius,\n          population: feature.properties.population,\n          directions: createDirection(feature)\n        }\n      : {}\n  );\n  const dirs = buffersToDirection(buffers);\n  const arcs = d3arc()\n    .outerRadius(size / 2)\n    .innerRadius(size / 3)\n    .padAngle(0.01);\n\n  return (\n    <svg className={classes.root} width={size} height={size}>\n      <g transform={`translate(${size / 2}, ${size / 2})`}>\n        {dirs.map((dir, index) => (\n          <g key={index}>\n            {dir.items.map((item, i) => {\n              const arc = d3arc()\n                .outerRadius(((size / 2 - 20) * item.to) / 10000)\n                .innerRadius(((size / 2 - 20) * item.from) / 10000 + 4)\n                .padAngle(0.01);\n              return (\n                <g key={i}>\n                  <path d={arc(item)} fill={color(calcDensity(item.val, item.from, item.to))} />\n                </g>\n              );\n            })}\n          </g>\n        ))}\n      </g>\n      <g>\n        <text x={size / 2} dy=\"1em\" textAnchor=\"middle\">\n          N\n        </text>\n        <text x={size / 2} y={size} textAnchor=\"middle\">\n          S\n        </text>\n        <text y={size / 2} dy=\".5em\" textAnchor=\"start\">\n          W\n        </text>\n        <text x={size} y={size / 2} dy=\".5em\" textAnchor=\"end\">\n          E\n        </text>\n      </g>\n    </svg>\n  );\n};\n\nexport default withStyles(styles)(BufferArcs);\n\n// utils\n\nfunction buffersToDirection(buffers: Buffer[]) {\n  const directions = ['north', 'northeast', 'east', 'southeast', 'south', 'southwest', 'west', 'northwest'];\n  const dirObjs = directions.map(str => ({\n    direction: str,\n    items: buffers.map((feature, index, arr) => ({\n      ...directionToAngle(str),\n      from: index > 0 ? arr[index - 1].properties.radius : 0,\n      to: feature.properties.radius,\n      val: index > 0 ? feature.properties[str] - arr[index - 1].properties[str] : feature.properties[str]\n    }))\n  }));\n  return dirObjs;\n}\n\nfunction createDirection(feature: Buffer) {\n  if (!feature.properties) return null;\n  const { north, northeast, east, southeast, south, southwest, west, northwest } = feature.properties;\n  const direction: any = { north, northeast, east, southeast, south, southwest, west, northwest };\n  for (let key in direction) {\n    const val = direction[key];\n    direction[key] = { ...directionToAngle(key), val, dir: key };\n  }\n  return direction;\n}\n\nfunction directionToAngle(key: string) {\n  const directions = ['north', 'northeast', 'east', 'southeast', 'south', 'southwest', 'west', 'northwest'];\n  const angle = (Math.PI * 2) / directions.length;\n  return {\n    startAngle: directions.indexOf(key) * angle - angle / 2,\n    endAngle: directions.indexOf(key) * angle + angle / 2\n  };\n}\n\nfunction calcDensity(val: number, from: number, to: number) {\n  return from === 0\n    ? (val * 8) / (Math.pow(to / 1000, 2) * Math.PI)\n    : (val * 8) / (Math.pow(to / 1000, 2) * Math.PI - Math.pow(from / 1000, 2) * Math.PI);\n}\n","import * as React from 'react';\nimport { graphql, Link, navigate } from 'gatsby';\nimport AppBar from '@material-ui/core/AppBar';\nimport ToolBar from '@material-ui/core/Toolbar';\nimport IconButton from '@material-ui/core/IconButton';\nimport ArrowForward from '@material-ui/icons/ArrowForward';\nimport Typography from '@material-ui/core/Typography';\nimport { Theme } from '@material-ui/core/styles/createMuiTheme';\nimport withStyles, { WithStyles, StyleRules } from '@material-ui/core/styles/withStyles';\nimport createStyles from '@material-ui/core/styles/createStyles';\nimport { AutoSizer } from 'react-virtualized';\nimport { feature as topofeature } from 'topojson-client';\nimport { Topology } from 'topojson-specification';\n\nimport MapApp from '../components/MapApp';\nimport BufferArcs from '../components/BuffersArcs';\nimport { Summary } from '../utils/types';\nimport withRoot from '../utils/withRoot';\n\nconst styles = (theme: Theme): StyleRules =>\n  createStyles({\n    root: {},\n    apptitle: {\n      flexGrow: 1\n    },\n    autoSizerWrapper: {\n      height: 'calc(100vh - 56px)'\n    },\n    description: {\n      maxWidth: 800,\n      margin: 'auto',\n      padding: '1em'\n    }\n  });\n\ninterface Props extends WithStyles<typeof styles> {\n  data: {\n    allVenuesJson: {\n      edges: Array<{\n        node: {\n          summary: {\n            slug: string;\n          };\n        };\n      }>;\n    };\n    venuesJson: {\n      fields: {\n        slug: string;\n      };\n      summary: Summary;\n      topojson: Topology;\n    };\n  };\n}\n\nconst MapPage: React.FunctionComponent<Props> = (props: Props) => {\n  const { classes, data } = props;\n  const { edges } = data.allVenuesJson;\n  const { summary, topojson } = data.venuesJson;\n  const geojson = topofeature(topojson, topojson.objects.points);\n  const buffers = topofeature(topojson, topojson.objects.buffers).features;\n\n  const { name, radius1000, radius3000, radius5000, radius10000 } = summary;\n\n  return (\n    <div className={classes.root}>\n      <AppBar position=\"static\">\n        <ToolBar>\n          <Typography color=\"inherit\" className={classes.apptitle} variant=\"h6\">\n            {name}\n          </Typography>\n          <IconButton\n            aria-owns=\"next\"\n            aria-haspopup=\"true\"\n            onClick={() => {\n              const slugs = edges.map(edge => edge.node.summary.slug);\n              const next = slugs[Math.round(Math.random() * slugs.length)];\n              navigate(`/${next}/`);\n            }}\n            color=\"inherit\"\n          >\n            <ArrowForward />\n          </IconButton>\n        </ToolBar>\n      </AppBar>\n      <div className={classes.autoSizerWrapper}>\n        <AutoSizer>{({ width, height }) => <MapApp width={width} height={height} geojson={geojson} buffers={buffers} />}</AutoSizer>\n      </div>\n      <div className={classes.description}>\n        <Typography variant=\"h4\">{name}</Typography>\n        <div>\n          <BufferArcs buffers={buffers} />\n        </div>\n        <ul>\n          <li>{`1km: ${radius1000}`}</li>\n          <li>{`3km: ${radius3000}`}</li>\n          <li>{`5km: ${radius5000}`}</li>\n          <li>{`10km: ${radius10000}`}</li>\n        </ul>\n        <Link to=\"/\">トップに戻る</Link>\n      </div>\n    </div>\n  );\n};\n\nexport default withRoot(withStyles(styles)(MapPage));\n\n// helper\nexport const query = graphql`\n  query($slug: String!) {\n    allVenuesJson {\n      edges {\n        node {\n          summary {\n            slug\n          }\n        }\n      }\n    }\n    venuesJson(fields: { slug: { eq: $slug } }) {\n      fields {\n        slug\n      }\n      summary {\n        name\n        shortname\n        category\n        radius1000\n        radius3000\n        radius5000\n        radius10000\n      }\n      topojson {\n        type\n        transform {\n          scale\n          translate\n        }\n        objects {\n          points {\n            type\n            geometries {\n              type\n              coordinates\n              properties {\n                id\n                val\n              }\n            }\n          }\n          buffers {\n            type\n            geometries {\n              type\n              arcs\n              properties {\n                radius\n                population\n                north\n                northeast\n                east\n                southeast\n                south\n                southwest\n                west\n                northwest\n              }\n            }\n          }\n        }\n        arcs\n      }\n    }\n  }\n`;\n","import React from \"react\"\nimport PropTypes from \"prop-types\"\nimport Link, {\n  withPrefix,\n  navigate,\n  push,\n  replace,\n  navigateTo,\n} from \"gatsby-link\"\nimport PageRenderer from \"./public-page-renderer\"\nimport parsePath from \"./parse-path\"\n\nconst StaticQueryContext = React.createContext({})\n\nconst StaticQuery = props => (\n  <StaticQueryContext.Consumer>\n    {staticQueryData => {\n      if (\n        props.data ||\n        (staticQueryData[props.query] && staticQueryData[props.query].data)\n      ) {\n        return (props.render || props.children)(\n          props.data ? props.data.data : staticQueryData[props.query].data\n        )\n      } else {\n        return <div>Loading (StaticQuery)</div>\n      }\n    }}\n  </StaticQueryContext.Consumer>\n)\n\nStaticQuery.propTypes = {\n  data: PropTypes.object,\n  query: PropTypes.string.isRequired,\n  render: PropTypes.func,\n  children: PropTypes.func,\n}\n\nfunction graphql() {\n  throw new Error(\n    `It appears like Gatsby is misconfigured. Gatsby related \\`graphql\\` calls ` +\n      `are supposed to only be evaluated at compile time, and then compiled away,. ` +\n      `Unfortunately, something went wrong and the query was left in the compiled code.\\n\\n.` +\n      `Unless your site has a complex or custom babel/Gatsby configuration this is likely a bug in Gatsby.`\n  )\n}\n\nexport {\n  Link,\n  withPrefix,\n  graphql,\n  parsePath,\n  navigate,\n  push, // TODO replace for v3\n  replace, // TODO remove replace for v3\n  navigateTo, // TODO: remove navigateTo for v3\n  StaticQueryContext,\n  StaticQuery,\n  PageRenderer,\n}\n","const preferDefault = m => (m && m.default) || m\n\nif (process.env.BUILD_STAGE === `develop`) {\n  module.exports = preferDefault(require(`./public-page-renderer-dev`))\n} else if (process.env.BUILD_STAGE === `build-javascript`) {\n  module.exports = preferDefault(require(`./public-page-renderer-prod`))\n} else {\n  module.exports = () => null\n}\n","import React from \"react\"\nimport PropTypes from \"prop-types\"\n\nimport InternalPageRenderer from \"./page-renderer\"\nimport loader from \"./loader\"\n\nconst ProdPageRenderer = ({ location }) => {\n  const pageResources = loader.getResourcesForPathnameSync(location.pathname)\n  return React.createElement(InternalPageRenderer, {\n    location,\n    pageResources,\n    ...pageResources.json,\n  })\n}\n\nProdPageRenderer.propTypes = {\n  location: PropTypes.shape({\n    pathname: PropTypes.string.isRequired,\n  }).isRequired,\n}\n\nexport default ProdPageRenderer\n","module.exports = \"data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxwYXRoIGQ9Ik0xMiAyQzguMTMgMiA1IDUuMTMgNSA5YzAgNS4yNSA3IDEzIDcgMTNzNy03Ljc1IDctMTNjMC0zLjg3LTMuMTMtNy03LTd6bTAiIGZpbGw9IiMwMDkxRUEiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMSIvPgogICAgPHBhdGggZD0iTTEyIDExLjVjLTEuMzggMC0yLjUtMS4xMi0yLjUtMi41czEuMTItMi41IDIuNS0yLjUgMi41IDEuMTIgMi41IDIuNS0xLjEyIDIuNS0yLjUgMi41eiIgZmlsbD0id2hpdGUiLz4KICAgIDxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz4KPC9zdmc+Cg==\"","import * as React from 'react';\nimport { MuiThemeProvider, createMuiTheme } from '@material-ui/core/styles';\nimport lightblue from '@material-ui/core/colors/lightBlue';\nimport blueGrey from '@material-ui/core/colors/blueGrey';\nimport CssBaseline from '@material-ui/core/CssBaseline';\n\nconst theme = createMuiTheme({\n  palette: {\n    primary: lightblue,\n    secondary: blueGrey\n  },\n  typography: {\n    useNextVariants: true\n  }\n});\n\nfunction withRoot<P>(Component: React.ComponentType<P>) {\n  function WithRoot(props: P) {\n    return (\n      <MuiThemeProvider theme={theme}>\n        <CssBaseline />\n        <Component {...props} />\n      </MuiThemeProvider>\n    );\n  }\n\n  return WithRoot;\n}\n\nexport default withRoot;\n","export interface Tile {\n  id: string;\n  x: number;\n  y: number;\n  z: number;\n  tx: number;\n  ty: number;\n  scale: number;\n  translate: [number, number];\n  mag: number;\n}\n\ntype TileUrl = string | undefined;\n\nexport interface TileWithURL extends Tile {\n  url: TileUrl;\n}\n\nexport interface TileTree {\n  [key: string]: {\n    [key: string]: {\n      [key: string]: TileUrl;\n    };\n  };\n}\n\ninterface TileSetOptions {\n  url?: string;\n}\n\nclass TileSet {\n  readonly tileTree: TileTree;\n  readonly tileUrl: string;\n  constructor(options: TileSetOptions = {}) {\n    this.tileUrl = options.url || '//cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png';\n    this.tileTree = {};\n  }\n\n  private treeIncludesTile(tile: Tile): boolean {\n    const { x, y, z } = tile;\n    return (\n      this.tileTree.hasOwnProperty(z.toString()) &&\n      this.tileTree[z.toString()].hasOwnProperty(x.toString()) &&\n      this.tileTree[z.toString()][x.toString()].hasOwnProperty(y.toString())\n    );\n  }\n\n  private tile2tree(tile: TileWithURL) {\n    const { x, y, z, url } = tile;\n    if (!this.tileTree.hasOwnProperty(z.toString())) {\n      this.tileTree[z.toString()] = {\n        [x.toString()]: {\n          [y.toString()]: url\n        }\n      };\n    } else if (!this.tileTree[z.toString()].hasOwnProperty(x.toString())) {\n      this.tileTree[z.toString()][x.toString()] = {\n        [y.toString()]: url\n      };\n    } else {\n      this.tileTree[z.toString()][x.toString()][y.toString()] = url;\n    }\n  }\n  // fetch new tiles\n  private fetchTiles(tiles: Tile[]): Promise<TileWithURL[]> {\n    return new Promise(resolve => {\n      const tasks = tiles.map(tile => this.fetchTile(tile, this.tileUrl));\n      Promise.all(tasks).then((data: TileWithURL[]) => {\n        resolve(data);\n      });\n    });\n  }\n  private fetchTile(tile: Tile, url: string): Promise<TileWithURL> {\n    const { x, y, z } = tile;\n    const fetchUrl = url.replace('{z}/{x}/{y}', `${z}/${x}/${y}`);\n\n    return fetch(fetchUrl)\n      .then(res => {\n        if (!res.ok) throw new Error();\n        return res.blob();\n      })\n      .then(blob => {\n        const tileWithURL: TileWithURL = {\n          ...tile,\n          url: URL.createObjectURL(blob)\n        };\n        this.tile2tree(tileWithURL);\n        return tileWithURL;\n      })\n      .catch(() => {\n        const tileWithURL: TileWithURL = {\n          ...tile,\n          url: undefined\n        };\n        this.tile2tree(tileWithURL);\n        return tileWithURL;\n      });\n  }\n\n  // helpers\n\n  public isRequireFetch(tiles: Tile[]): boolean {\n    return !tiles.every(tile => this.treeIncludesTile(tile));\n  }\n\n  public setTileUrlFromTree(tiles: Tile[]): TileWithURL[] {\n    return tiles\n      .filter(tile => this.treeIncludesTile(tile))\n      .map(tile => ({\n        ...tile,\n        url: this.tileTree[tile.z][tile.x][tile.y]\n      }));\n  }\n\n  public async updateTiles(newTiles: Tile[]) {\n    const tilesInTree = this.setTileUrlFromTree(newTiles.filter(tile => this.treeIncludesTile(tile)));\n\n    const tilesShouldFetch = newTiles.filter(tile => !this.treeIncludesTile(tile));\n\n    const fetchedTiles: TileWithURL[] = await this.fetchTiles(tilesShouldFetch);\n\n    return [...tilesInTree, ...fetchedTiles];\n  }\n}\n\nexport default TileSet;\n","import * as React from 'react';\nimport { scaleLinear, scalePow, scaleSequential } from 'd3-scale';\nimport { interpolateSpectral } from 'd3-scale-chromatic';\nimport { Feature, Point } from '@turf/helpers';\nimport { GeoProjection } from 'd3-geo';\n\nimport { MeshProperties } from '../utils/types';\n\ninterface Props {\n  feature: Feature<Point, MeshProperties>;\n  projection: GeoProjection;\n}\n\nconst colorScale = scaleSequential(interpolateSpectral).domain([1000, 0]);\n\nconst sizeScale = scalePow()\n  .domain([0, 1000])\n  .range([0, 8])\n  .exponent(0.5);\n\nconst MeshRect: React.FunctionComponent<Props> = (props: Props) => {\n  const { feature, projection } = props;\n  const { val } = feature.properties;\n  const center = projection(feature.geometry.coordinates);\n  const size = Math.abs(sizeScale(val) * Math.max(1, projection.scale() / 125000));\n\n  return (\n    <rect\n      fill={colorScale(val)}\n      fillOpacity={0.6}\n      x={center[0] - size / 2}\n      y={center[1] - size / 2}\n      width={size}\n      height={size}\n      style={{ mixBlendMode: 'multiply' }}\n    />\n  );\n};\n\nexport default MeshRect;\n","import * as React from 'react';\n/*\nconst filterMatrix = [\n  \"0.3333 0.3333 0.3333 0 0\",\n  \"0.3333 0.3333 0.3333 0 0\",\n  \"0.3333 0.3333 0.3333 0 0\",\n  \"0 0 0 1 0\"\n];\n*/\nconst filterMatrix = ['0.3333 0.3333 0.3333 0 0', '0.3333 0.3333 0.3333 0 0', '0.3333 0.3333 0.3333 0 0', '0 0 0 1 0'];\n\ninterface Props {\n  id: string;\n}\n\nconst GrayScaleFilter: React.FunctionComponent<Props> = (props: Props) => (\n  <filter id={props.id}>\n    <feColorMatrix type=\"matrix\" values={filterMatrix.join(' ')} />\n  </filter>\n);\n\nexport default GrayScaleFilter;\n","import * as React from 'react';\nimport { Theme } from '@material-ui/core/styles/createMuiTheme';\nimport withStyles, { WithStyles, StyleRules } from '@material-ui/core/styles/withStyles';\nimport createStyles from '@material-ui/core/styles/createStyles';\nconst d3tile = require('d3-tile').tile;\n\nimport { geoMercator, geoPath, GeoProjection, GeoPath } from 'd3-geo';\nimport TileSet, { Tile, TileWithURL } from '../utils/tileTree';\nimport MeshFeature from '../components/MeshFeature';\nimport GrayScaleFilter from '../components/GrayScaleFilter';\nimport { Feature, Point } from '@turf/helpers';\nimport { Buffer, MeshProperties } from '../utils/types';\n\nimport Place from '../image/place.svg';\n\nconst styles = (theme: Theme): StyleRules =>\n  createStyles({\n    root: {},\n    tiles: {\n      transition: 'opacity 1s'\n    },\n    buffer: {\n      fill: 'none',\n      stroke: theme.palette.primary.main,\n      strokeWidth: 2\n    },\n    points: {\n      transition: 'opacity 1s .5s'\n    }\n  });\n\ninterface D3TileArray<T> extends Array<T> {\n  scale: number;\n  translate: [number, number];\n}\n\ninterface Props extends WithStyles<typeof styles> {\n  width: number;\n  height: number;\n  geojson: {\n    type: 'FeatureCollection';\n    features: Feature<Point, MeshProperties>[];\n  };\n  buffers: Buffer[];\n}\n\ninterface State {\n  readonly fetchStatus?: 'yet' | 'fetching' | 'fetched';\n}\n\nclass Map extends React.Component<Props, State> {\n  readonly state: State = {\n    fetchStatus: 'yet'\n  };\n  _tileSet = new TileSet();\n  // Tile Maps\n  // slope: //cyberjapandata.gsi.go.jp/xyz/slopemap/{z}/{x}/{y}.png\n\n  private _getTileCoordinates = (projection: GeoProjection): Tile[] => {\n    const { width, height } = this.props;\n    const mag: number = 1.5;\n\n    const tiles: Tile[] = d3tile()\n      .size([width * mag, height * mag])\n      .scale(projection.scale() * 2 * Math.PI * mag)\n      .translate(projection([0, 0]).map(v => v * mag))()\n      .map((tile: { x: number; y: number; z: number }, index: number, array: D3TileArray<Tile>) => ({\n        ...tile,\n        mag,\n        id: `${tile.z}/${tile.x}/${tile.y}`,\n        scale: array.scale,\n        translate: array.translate\n      }));\n\n    return tiles;\n  };\n\n  private _fetchTiles = (tiles: Tile[]) => {\n    return this._tileSet.updateTiles(tiles);\n  };\n\n  componentDidMount() {}\n\n  public render() {\n    const { classes, width, height, buffers, geojson } = this.props;\n    const projection = buffers\n      ? geoMercator().fitExtent([[10, 40], [width - 10, height - 40]], buffers[buffers.length - 1])\n      : geoMercator();\n\n    const path: GeoPath = geoPath(projection);\n    const tileCoords = this._getTileCoordinates(projection);\n\n    let renderTiles: TileWithURL[] = this._tileSet.setTileUrlFromTree(tileCoords);\n\n    if (this._tileSet.isRequireFetch(tileCoords)) {\n      this._fetchTiles(tileCoords).then(newTiles => {\n        this.setState({ fetchStatus: 'fetched' });\n      });\n    }\n\n    return (\n      <svg className={classes.root} width={width} height={height}>\n        <g>\n          <GrayScaleFilter id=\"grayscale\" />\n          <g filter=\"url(#grayscale)\" className={classes.tiles} style={{ opacity: this.state.fetchStatus === 'fetched' ? 1 : 0 }}>\n            {renderTiles.map((tile, index) => (\n              <image\n                key={index}\n                xlinkHref={tile.url}\n                x={((tile.x + tile.translate[0]) * tile.scale) / tile.mag}\n                y={((tile.y + tile.translate[1]) * tile.scale) / tile.mag}\n                width={tile.scale / tile.mag}\n                height={tile.scale / tile.mag}\n              />\n            ))}\n          </g>\n        </g>\n        <g>\n          {buffers.length\n            ? buffers.map((feature, index) => (\n                <path key={index} d={path(feature)} fill=\"none\" stroke=\"rgba(200, 60, 80, 0.2)\" strokeWidth={3} />\n              ))\n            : null}\n        </g>\n        <g className={classes.points} style={{ opacity: this.state.fetchStatus === 'fetched' ? 1 : 0 }}>\n          {geojson\n            ? geojson.features.map((feature, index) =>\n                feature.geometry.type === 'Point' ? <MeshFeature key={index} feature={feature} projection={projection} /> : null\n              )\n            : null}\n        </g>\n        <g>\n          <image xlinkHref={Place} x={width / 2} y={height / 2} width={28} height={28} transform=\"translate(-14, -26)\" />\n        </g>\n      </svg>\n    );\n  }\n}\n\nexport default withStyles(styles)(Map);\n"],"sourceRoot":""}