{"version":3,"sources":["webpack:///./src/templates/maps.tsx","webpack:///./.cache/gatsby-browser-entry.js","webpack:///./.cache/public-page-renderer.js","webpack:///./.cache/public-page-renderer-prod.js","webpack:///./src/image/place.svg","webpack:///./src/utils/tileTree.ts","webpack:///./src/components/MeshFeature.tsx","webpack:///./src/components/GrayScaleFilter.tsx","webpack:///./src/components/MapApp.tsx"],"names":["withStyles","theme","createStyles","root","apptitle","flexGrow","autoSizerWrapper","height","props","classes","data","geojson","topofeature","topojsonJson","objects","radius5000","buffer","features","filter","feature","geometry","type","bufferLarge","circle","center","units","console","log","name","properties","Object","_emotion_core__WEBPACK_IMPORTED_MODULE_2__","className","_material_ui_core_AppBar__WEBPACK_IMPORTED_MODULE_5___default","a","position","_material_ui_core_Toolbar__WEBPACK_IMPORTED_MODULE_6___default","_material_ui_core_Typography__WEBPACK_IMPORTED_MODULE_9___default","color","variant","_material_ui_core_IconButton__WEBPACK_IMPORTED_MODULE_7___default","aria-owns","aria-haspopup","onClick","next","Math","round","random","navigate","toString","_material_ui_icons_ArrowForward__WEBPACK_IMPORTED_MODULE_8___default","react_virtualized__WEBPACK_IMPORTED_MODULE_12__","_ref","width","_components_MapApp__WEBPACK_IMPORTED_MODULE_16__","gatsby__WEBPACK_IMPORTED_MODULE_4__","to","query","StaticQueryContext","React","createContext","StaticQuery","_emotion_core__WEBPACK_IMPORTED_MODULE_0__","Consumer","staticQueryData","render","children","graphql","Error","propTypes","PropTypes","object","string","isRequired","func","m","module","exports","require","default","ProdPageRenderer","location","pageResources","loader","getResourcesForPathnameSync","pathname","createElement","InternalPageRenderer","assign","json","shape","TileSet","options","this","tileUrl","url","tileTree","treeIncludesTile","tile","x","y","z","hasOwnProperty","tile2tree","_x$toString","_this$tileTree$z$toSt","_this$tileTree$z$toSt2","fetchTiles","tiles","_this","Promise","resolve","tasks","map","fetchTile","all","then","_this2","fetchUrl","replace","fetch","res","ok","blob","tileWithURL","URL","createObjectURL","catch","undefined","isRequireFetch","_this3","every","setTileUrlFromTree","_this4","updateTiles","_callee","newTiles","tilesInTree","tilesShouldFetch","fetchedTiles","_this5","regenerator_default","wrap","_context","prev","sent","abrupt","concat","stop","colorScale","scaleSequential","interpolateSpectral","domain","sizeScale","scaleLinear","range","MeshRect","projection","val","coordinates","size","abs","scale","core_browser_esm","fill","fillOpacity","style","mixBlendMode","filterMatrix","GrayScaleFilter","id","values","join","d3tile","Map","state","fetchStatus","_projection","geoMercator","_tileSet","_getTileCoordinates","_this$props","PI","translate","v","index","array","mag","_fetchTiles","componentDidMount","_this$props2","fitExtent","path","geoPath","tileCoords","renderTiles","setState","components_GrayScaleFilter","opacity","key","xlinkHref","d","points","ftr","MeshFeature","Place","transform","transition","stroke","palette","primary","main","strokeWidth"],"mappings":"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","file":"component---src-templates-maps-tsx-8ae57cdeb32fc7ba9411.js","sourcesContent":["import * as React from 'react';\nimport { graphql, Link, navigate } from 'gatsby';\nimport AppBar from '@material-ui/core/AppBar';\nimport ToolBar from '@material-ui/core/Toolbar';\nimport IconButton from '@material-ui/core/IconButton';\nimport ArrowForward from '@material-ui/icons/ArrowForward';\nimport Typography from '@material-ui/core/Typography';\nimport { Theme } from '@material-ui/core/styles/createMuiTheme';\nimport withStyles, { WithStyles, StyleRules } from '@material-ui/core/styles/withStyles';\nimport createStyles from '@material-ui/core/styles/createStyles';\nimport { AutoSizer } from 'react-virtualized';\nimport { feature as topofeature } from 'topojson-client';\nimport { Topology } from 'topojson-specification';\n\nimport circle from '@turf/circle';\nimport center from '@turf/center';\nimport MapApp from '../components/MapApp';\n\nconst styles = (theme: Theme): StyleRules =>\n  createStyles({\n    root: {},\n    apptitle: {\n      flexGrow: 1\n    },\n    autoSizerWrapper: {\n      height: 'calc(100vh - 56px)'\n    }\n  });\n\ninterface Props extends WithStyles<typeof styles> {\n  data: {\n    topojsonJson: Topology;\n  };\n}\n\nconst MapPage: React.FunctionComponent<Props> = (props: Props) => {\n  const { classes, data } = props;\n  const geojson = topofeature(data.topojsonJson, data.topojsonJson.objects.radius5000);\n  const buffer = geojson.features.filter(feature => feature.geometry.type === 'Polygon')[0];\n  const bufferLarge = circle(center(buffer), 10, {\n    units: 'kilometers'\n  });\n  console.log(bufferLarge);\n  const { name } = buffer.properties;\n\n  return (\n    <div className={classes.root}>\n      <AppBar position=\"static\">\n        <ToolBar>\n          <Typography color=\"inherit\" className={classes.apptitle} variant=\"h6\">\n            {name}\n          </Typography>\n          <IconButton\n            aria-owns=\"next\"\n            aria-haspopup=\"true\"\n            onClick={() => {\n              const next = Math.round(Math.random() * 101);\n              navigate(`/${next.toString()}/`);\n            }}\n            color=\"inherit\"\n          >\n            <ArrowForward />\n          </IconButton>\n        </ToolBar>\n      </AppBar>\n      <div className={classes.autoSizerWrapper}>\n        <AutoSizer>{({ width, height }) => <MapApp width={width} height={height} geojson={geojson} feature={buffer} />}</AutoSizer>\n      </div>\n      <div>\n        <Typography variant=\"h4\">{name}</Typography>\n        <Link to=\"/\">トップに戻る</Link>\n      </div>\n    </div>\n  );\n};\n\nexport default withStyles(styles)(MapPage);\n\n// helper\nexport const query = graphql`\n  query($slug: String!) {\n    topojsonJson(fields: { slug: { eq: $slug } }) {\n      type\n      objects {\n        radius5000 {\n          type\n          geometries {\n            type\n            properties {\n              id\n              val\n              name\n            }\n            arcs\n            coordinates\n          }\n        }\n      }\n      arcs\n      transform {\n        scale\n        translate\n      }\n    }\n  }\n`;\n","import React from \"react\"\nimport PropTypes from \"prop-types\"\nimport Link, {\n  withPrefix,\n  navigate,\n  push,\n  replace,\n  navigateTo,\n} from \"gatsby-link\"\nimport PageRenderer from \"./public-page-renderer\"\nimport parsePath from \"./parse-path\"\n\nconst StaticQueryContext = React.createContext({})\n\nconst StaticQuery = props => (\n  <StaticQueryContext.Consumer>\n    {staticQueryData => {\n      if (\n        props.data ||\n        (staticQueryData[props.query] && staticQueryData[props.query].data)\n      ) {\n        return (props.render || props.children)(\n          props.data ? props.data.data : staticQueryData[props.query].data\n        )\n      } else {\n        return <div>Loading (StaticQuery)</div>\n      }\n    }}\n  </StaticQueryContext.Consumer>\n)\n\nStaticQuery.propTypes = {\n  data: PropTypes.object,\n  query: PropTypes.string.isRequired,\n  render: PropTypes.func,\n  children: PropTypes.func,\n}\n\nfunction graphql() {\n  throw new Error(\n    `It appears like Gatsby is misconfigured. Gatsby related \\`graphql\\` calls ` +\n      `are supposed to only be evaluated at compile time, and then compiled away,. ` +\n      `Unfortunately, something went wrong and the query was left in the compiled code.\\n\\n.` +\n      `Unless your site has a complex or custom babel/Gatsby configuration this is likely a bug in Gatsby.`\n  )\n}\n\nexport {\n  Link,\n  withPrefix,\n  graphql,\n  parsePath,\n  navigate,\n  push, // TODO replace for v3\n  replace, // TODO remove replace for v3\n  navigateTo, // TODO: remove navigateTo for v3\n  StaticQueryContext,\n  StaticQuery,\n  PageRenderer,\n}\n","const preferDefault = m => (m && m.default) || m\n\nif (process.env.BUILD_STAGE === `develop`) {\n  module.exports = preferDefault(require(`./public-page-renderer-dev`))\n} else if (process.env.BUILD_STAGE === `build-javascript`) {\n  module.exports = preferDefault(require(`./public-page-renderer-prod`))\n} else {\n  module.exports = () => null\n}\n","import React from \"react\"\nimport PropTypes from \"prop-types\"\n\nimport InternalPageRenderer from \"./page-renderer\"\nimport loader from \"./loader\"\n\nconst ProdPageRenderer = ({ location }) => {\n  const pageResources = loader.getResourcesForPathnameSync(location.pathname)\n  return React.createElement(InternalPageRenderer, {\n    location,\n    pageResources,\n    ...pageResources.json,\n  })\n}\n\nProdPageRenderer.propTypes = {\n  location: PropTypes.shape({\n    pathname: PropTypes.string.isRequired,\n  }).isRequired,\n}\n\nexport default ProdPageRenderer\n","module.exports = \"data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxwYXRoIGQ9Ik0xMiAyQzguMTMgMiA1IDUuMTMgNSA5YzAgNS4yNSA3IDEzIDcgMTNzNy03Ljc1IDctMTNjMC0zLjg3LTMuMTMtNy03LTd6bTAiIGZpbGw9IiMwMDkxRUEiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMSIvPgogICAgPHBhdGggZD0iTTEyIDExLjVjLTEuMzggMC0yLjUtMS4xMi0yLjUtMi41czEuMTItMi41IDIuNS0yLjUgMi41IDEuMTIgMi41IDIuNS0xLjEyIDIuNS0yLjUgMi41eiIgZmlsbD0id2hpdGUiLz4KICAgIDxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz4KPC9zdmc+Cg==\"","export interface Tile {\n  id: string;\n  x: number;\n  y: number;\n  z: number;\n  tx: number;\n  ty: number;\n  scale: number;\n  translate: [number, number];\n  mag: number;\n}\n\ntype TileUrl = string | undefined;\n\nexport interface TileWithURL extends Tile {\n  url: TileUrl;\n}\n\nexport interface TileTree {\n  [key: string]: {\n    [key: string]: {\n      [key: string]: TileUrl;\n    };\n  };\n}\n\ninterface TileSetOptions {\n  url?: string;\n}\n\nclass TileSet {\n  readonly tileTree: TileTree;\n  readonly tileUrl: string;\n  constructor(options: TileSetOptions = {}) {\n    this.tileUrl = options.url || '//cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png';\n    this.tileTree = {};\n  }\n\n  private treeIncludesTile(tile: Tile): boolean {\n    const { x, y, z } = tile;\n    return (\n      this.tileTree.hasOwnProperty(z.toString()) &&\n      this.tileTree[z.toString()].hasOwnProperty(x.toString()) &&\n      this.tileTree[z.toString()][x.toString()].hasOwnProperty(y.toString())\n    );\n  }\n\n  private tile2tree(tile: TileWithURL) {\n    const { x, y, z, url } = tile;\n    if (!this.tileTree.hasOwnProperty(z.toString())) {\n      this.tileTree[z.toString()] = {\n        [x.toString()]: {\n          [y.toString()]: url\n        }\n      };\n    } else if (!this.tileTree[z.toString()].hasOwnProperty(x.toString())) {\n      this.tileTree[z.toString()][x.toString()] = {\n        [y.toString()]: url\n      };\n    } else {\n      this.tileTree[z.toString()][x.toString()][y.toString()] = url;\n    }\n  }\n  // fetch new tiles\n  private fetchTiles(tiles: Tile[]): Promise<TileWithURL[]> {\n    return new Promise(resolve => {\n      const tasks = tiles.map(tile => this.fetchTile(tile, this.tileUrl));\n      Promise.all(tasks).then((data: TileWithURL[]) => {\n        resolve(data);\n      });\n    });\n  }\n  private fetchTile(tile: Tile, url: string): Promise<TileWithURL> {\n    const { x, y, z } = tile;\n    const fetchUrl = url.replace('{z}/{x}/{y}', `${z}/${x}/${y}`);\n\n    return fetch(fetchUrl)\n      .then(res => {\n        if (!res.ok) throw new Error();\n        return res.blob();\n      })\n      .then(blob => {\n        const tileWithURL: TileWithURL = {\n          ...tile,\n          url: URL.createObjectURL(blob)\n        };\n        this.tile2tree(tileWithURL);\n        return tileWithURL;\n      })\n      .catch(() => {\n        const tileWithURL: TileWithURL = {\n          ...tile,\n          url: undefined\n        };\n        this.tile2tree(tileWithURL);\n        return tileWithURL;\n      });\n  }\n\n  // helpers\n\n  public isRequireFetch(tiles: Tile[]): boolean {\n    return !tiles.every(tile => this.treeIncludesTile(tile));\n  }\n\n  public setTileUrlFromTree(tiles: Tile[]): TileWithURL[] {\n    return tiles\n      .filter(tile => this.treeIncludesTile(tile))\n      .map(tile => ({\n        ...tile,\n        url: this.tileTree[tile.z][tile.x][tile.y]\n      }));\n  }\n\n  public async updateTiles(newTiles: Tile[]) {\n    const tilesInTree = this.setTileUrlFromTree(newTiles.filter(tile => this.treeIncludesTile(tile)));\n\n    const tilesShouldFetch = newTiles.filter(tile => !this.treeIncludesTile(tile));\n\n    const fetchedTiles: TileWithURL[] = await this.fetchTiles(tilesShouldFetch);\n\n    return [...tilesInTree, ...fetchedTiles];\n  }\n}\n\nexport default TileSet;\n","import * as React from 'react';\nimport { scaleLinear, scaleSequential } from 'd3-scale';\nimport { interpolateSpectral } from 'd3-scale-chromatic';\nimport { Feature } from '@turf/helpers';\nimport { GeoProjection } from 'd3-geo';\n\ninterface MeshFeature extends Feature {\n  properties: {\n    val: number;\n  };\n}\n\ninterface Props {\n  feature: MeshFeature;\n  projection: GeoProjection;\n}\n\nconst colorScale = scaleSequential(interpolateSpectral /*interpolateYlOrRd*/).domain([1000, 0]);\nconst sizeScale = scaleLinear()\n  .domain([0, 1000])\n  .range([2, 8]);\n\nconst MeshRect: React.FunctionComponent<Props> = (props: Props) => {\n  const { feature, projection } = props;\n  const { val } = feature.properties;\n  const center = projection(feature.geometry.coordinates);\n  const size = Math.abs((sizeScale(val) * projection.scale()) / 175216);\n\n  return (\n    <rect\n      fill={colorScale(val)}\n      fillOpacity={0.6}\n      x={center[0] - size / 2}\n      y={center[1] - size / 2}\n      width={size}\n      height={size}\n      style={{ mixBlendMode: 'multiply' }}\n    />\n  );\n};\n\nexport default MeshRect;\n","import * as React from 'react';\n/*\nconst filterMatrix = [\n  \"0.3333 0.3333 0.3333 0 0\",\n  \"0.3333 0.3333 0.3333 0 0\",\n  \"0.3333 0.3333 0.3333 0 0\",\n  \"0 0 0 1 0\"\n];\n*/\nconst filterMatrix = ['0.3333 0.3333 0.3333 0 0', '0.3333 0.3333 0.3333 0 0', '0.3333 0.3333 0.3333 0 0', '0 0 0 1 0'];\n\ninterface Props {\n  id: string;\n}\n\nconst GrayScaleFilter: React.FunctionComponent<Props> = (props: Props) => (\n  <filter id={props.id}>\n    <feColorMatrix type=\"matrix\" values={filterMatrix.join(' ')} />\n  </filter>\n);\n\nexport default GrayScaleFilter;\n","import * as React from 'react';\nimport { Theme } from '@material-ui/core/styles/createMuiTheme';\nimport withStyles, { WithStyles, StyleRules } from '@material-ui/core/styles/withStyles';\nimport createStyles from '@material-ui/core/styles/createStyles';\nconst d3tile = require('d3-tile').tile;\n\nimport { geoMercator, geoPath, GeoProjection, GeoPath, ExtendedFeature } from 'd3-geo';\nimport centroid from '@turf/centroid';\nimport TileSet, { Tile, TileWithURL } from '../utils/tileTree';\nimport MeshFeature from '../components/MeshFeature';\nimport GrayScaleFilter from '../components/GrayScaleFilter';\nimport { GeoJSONObject } from '@turf/helpers';\n\nimport Place from '../image/place.svg';\n\nconst styles = (theme: Theme): StyleRules =>\n  createStyles({\n    root: {},\n    tiles: {\n      transition: 'opacity 1s'\n    },\n    buffer: {\n      fill: 'none',\n      stroke: theme.palette.primary.main,\n      strokeWidth: 2\n    },\n    points: {\n      transition: 'opacity 1s .5s'\n    }\n  });\n\ninterface D3TileArray<T> extends Array<T> {\n  scale: number;\n  translate: [number, number];\n}\n\ninterface Props extends WithStyles<typeof styles> {\n  width: number;\n  height: number;\n  geojson?: GeoJSONObject;\n  feature?: ExtendedFeature;\n}\n\ninterface State {\n  readonly fetchStatus?: 'yet' | 'fetching' | 'fetched';\n}\n\nclass Map extends React.Component<Props, State> {\n  readonly state: State = {\n    fetchStatus: 'yet'\n  };\n  _projection: GeoProjection = geoMercator();\n  _tileSet = new TileSet({ url: '//cyberjapandata.gsi.go.jp/xyz/slopemap/{z}/{x}/{y}.png' });\n\n  private _getTileCoordinates = (projection: GeoProjection): Tile[] => {\n    const { width, height } = this.props;\n    const mag: number = 1.5;\n\n    const tiles: Tile[] = d3tile()\n      .size([width * mag, height * mag])\n      .scale(projection.scale() * 2 * Math.PI * mag)\n      .translate(projection([0, 0]).map(v => v * mag))()\n      .map((tile: { x: number; y: number; z: number }, index: number, array: D3TileArray<Tile>) => ({\n        ...tile,\n        mag,\n        id: `${tile.z}/${tile.x}/${tile.y}`,\n        scale: array.scale,\n        translate: array.translate\n      }));\n\n    return tiles;\n  };\n\n  private _fetchTiles = (tiles: Tile[]) => {\n    return this._tileSet.updateTiles(tiles);\n  };\n\n  componentDidMount() {\n    console.log('Component Did Mount');\n    console.log(this.props.geojson);\n  }\n\n  public render() {\n    console.log('Render');\n    const { classes, width, height, feature, geojson } = this.props;\n    const projection = geoMercator().fitExtent([[20, 20], [width - 20, height - 20]], feature);\n    console.log(projection.scale());\n    const path: GeoPath = geoPath(projection);\n    const tileCoords = this._getTileCoordinates(projection);\n\n    console.log(tileCoords);\n    console.log(projection.scale());\n\n    let renderTiles: TileWithURL[] = this._tileSet.setTileUrlFromTree(tileCoords);\n\n    if (this._tileSet.isRequireFetch(tileCoords) /*tiles.length !== tileCoords.length*/) {\n      console.log('Fetch Tiles Starts');\n      this._fetchTiles(tileCoords).then(newTiles => {\n        this.setState({ fetchStatus: 'fetched' });\n        console.log('Fetch Tiles Ends');\n        console.log(newTiles);\n      });\n    }\n\n    return (\n      <svg className={classes.root} width={width} height={height}>\n        <g>\n          <GrayScaleFilter id=\"grayscale\" />\n          <g filter=\"url(#grayscale)\" className={classes.tiles} style={{ opacity: this.state.fetchStatus === 'fetched' ? 1 : 0 }}>\n            {renderTiles.map((tile, index) => (\n              <image\n                key={index}\n                xlinkHref={tile.url}\n                x={((tile.x + tile.translate[0]) * tile.scale) / tile.mag}\n                y={((tile.y + tile.translate[1]) * tile.scale) / tile.mag}\n                width={tile.scale / tile.mag}\n                height={tile.scale / tile.mag}\n              />\n            ))}\n          </g>\n        </g>\n        <path className={classes.buffer} d={path(feature) || undefined} />\n        <g className={classes.points} style={{ opacity: this.state.fetchStatus === 'fetched' ? 1 : 0 }}>\n          {geojson\n            ? geojson.features.map((ftr, index) =>\n                ftr.geometry.type === 'Point' ? <MeshFeature key={index} feature={ftr} projection={projection} /> : null\n              )\n            : null}\n        </g>\n        <g>\n          <image xlinkHref={Place} x={width / 2} y={height / 2} width={28} height={28} transform=\"translate(-14, -26)\" />\n        </g>\n      </svg>\n    );\n  }\n}\n\nexport default withStyles(styles)(Map);\n"],"sourceRoot":""}